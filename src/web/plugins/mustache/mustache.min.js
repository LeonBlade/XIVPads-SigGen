!function(t,e){"object"==typeof exports&&exports?e(exports):"function"==typeof define&&define.amd?define(e({})):t.Mustache=e({})}(this,function(t){function e(t){return"function"==typeof t}function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(t,e){return p.call(t,e)}function i(t){return!a(d,t)}function s(t){return String(t).replace(/[&<>"'\/]/g,function(t){return x[t]})}function o(e,a){function s(){if(b&&!k)for(;x.length;)delete d[x.pop()];else x=[];b=!1,k=!1}function o(t){if("string"==typeof t&&(t=t.split($,2)),!l(t)||2!==t.length)throw new Error("Invalid tags: "+t);h=new RegExp(n(t[0])+"\\s*"),u=new RegExp("\\s*"+n(t[1])),g=new RegExp("\\s*"+n("}"+t[1]))}if(!e)return[];var h,u,g,p=[],d=[],x=[],b=!1,k=!1;o(a||t.tags);for(var j,C,T,H,U,A,E=new v(e);!E.eos();){if(j=E.pos,T=E.scanUntil(h))for(var M=0,F=T.length;F>M;++M)H=T.charAt(M),i(H)?x.push(d.length):k=!0,d.push(["text",H,j,j+1]),j+=1,"\n"===H&&s();if(!E.scan(h))break;if(b=!0,C=E.scan(w)||"name",E.scan(f),"="===C?(T=E.scanUntil(y),E.scan(y),E.scanUntil(u)):"{"===C?(T=E.scanUntil(g),E.scan(m),E.scanUntil(u),C="&"):T=E.scanUntil(u),!E.scan(u))throw new Error("Unclosed tag at "+E.pos);if(U=[C,T,j,E.pos],d.push(U),"#"===C||"^"===C)p.push(U);else if("/"===C){if(A=p.pop(),!A)throw new Error('Unopened section "'+T+'" at '+j);if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+j)}else"name"===C||"{"===C||"&"===C?k=!0:"="===C&&o(T)}if(A=p.pop())throw new Error('Unclosed section "'+A[1]+'" at '+E.pos);return r(c(d))}function c(t){for(var e,n,a=[],i=0,s=t.length;s>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(a.push(e),n=e));return a}function r(t){for(var e,n,a=[],i=a,s=[],o=0,c=t.length;c>o;++o)switch(e=t[o],e[0]){case"#":case"^":i.push(e),s.push(e),i=e[4]=[];break;case"/":n=s.pop(),n[5]=e[2],i=s.length>0?s[s.length-1][4]:a;break;default:i.push(e)}return a}function v(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=null==t?{}:t,this.cache={".":this.view},this.parent=e}function u(){this.cache={}}var g=Object.prototype.toString,l=Array.isArray||function(t){return"[object Array]"===g.call(t)},p=RegExp.prototype.test,d=/\S/,x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},f=/\s*/,$=/\s+/,y=/\s*=/,m=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/;v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},v.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(t){var n,a=this.cache;if(t in a)n=a[t];else{for(var i,s,o=this;o;){if(t.indexOf(".")>0)for(n=o.view,i=t.split("."),s=0;null!=n&&s<i.length;)n=n[i[s++]];else n=o.view[t];if(null!=n)break;o=o.parent}a[t]=n}return e(n)&&(n=n.call(this.view)),n},u.prototype.clearCache=function(){this.cache={}},u.prototype.parse=function(t,e){var n=this.cache,a=n[t];return null==a&&(a=n[t]=o(t,e)),a},u.prototype.render=function(t,e,n){var a=this.parse(t),i=e instanceof h?e:new h(e);return this.renderTokens(a,i,n,t)},u.prototype.renderTokens=function(n,a,i,s){function o(t){return h.render(t,a,i)}for(var c,r,v="",h=this,u=0,g=n.length;g>u;++u)switch(c=n[u],c[0]){case"#":if(r=a.lookup(c[1]),!r)continue;if(l(r))for(var p=0,d=r.length;d>p;++p)v+=this.renderTokens(c[4],a.push(r[p]),i,s);else if("object"==typeof r||"string"==typeof r)v+=this.renderTokens(c[4],a.push(r),i,s);else if(e(r)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");r=r.call(a.view,s.slice(c[3],c[5]),o),null!=r&&(v+=r)}else v+=this.renderTokens(c[4],a,i,s);break;case"^":r=a.lookup(c[1]),(!r||l(r)&&0===r.length)&&(v+=this.renderTokens(c[4],a,i,s));break;case">":if(!i)continue;r=e(i)?i(c[1]):i[c[1]],null!=r&&(v+=this.renderTokens(this.parse(r),a,i,r));break;case"&":r=a.lookup(c[1]),null!=r&&(v+=r);break;case"name":r=a.lookup(c[1]),null!=r&&(v+=t.escape(r));break;case"text":v+=c[1]}return v},t.name="mustache.js",t.version="0.8.1",t.tags=["{{","}}"];var b=new u;return t.clearCache=function(){return b.clearCache()},t.parse=function(t,e){return b.parse(t,e)},t.render=function(t,e,n){return b.render(t,e,n)},t.to_html=function(n,a,i,s){var o=t.render(n,a,i);return e(s)?(s(o),void 0):o},t.escape=s,t.Scanner=v,t.Context=h,t.Writer=u,t});